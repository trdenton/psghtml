<html>
<head>
<title>PSG chord explorer</title>
<link rel="stylesheet" href="../dm.css">
<style>

td {
  white-space: pre;
  font-family: monospace;
}
</style>

<script src='psg.js' type='text/javascript'></script>
<script type='text/javascript'>

NUM_FRETS = 24;

function buildAllOptions(elem_id, chord) {
    const div = document.getElementById(elem_id);
    const tbl = document.createElement('table');
    tbl.style.width = '100px';
    tbl.style.border = '1px solid gray';

    const options = findChordPositions(chord);
    const firstRow = tbl.insertRow();
    firstRow.insertCell().appendChild(document.createTextNode("fret")).border = '1px solid grey';
    firstRow.insertCell().appendChild(document.createTextNode("pedals")).border = '1px solid grey';
    firstRow.insertCell().appendChild(document.createTextNode("levers")).border = '1px solid grey';

    options.forEach((option) => {
        const row = tbl.insertRow();
        row.insertCell().appendChild(document.createTextNode(option[0])).border = '1px solid grey';
        row.insertCell().appendChild(document.createTextNode(option[1])).border = '1px solid grey';
        row.insertCell().appendChild(document.createTextNode(option[2])).border = '1px solid grey';
    });

    div.innerHTML = "";
    div.appendChild(tbl);
}

function fretboardCreate(psg, elem_id, chord) {
    const divFretboard = document.getElementById(elem_id);
    const body = document.body,
          tbl = document.createElement('table');
    tbl.style.width = '100px';
    tbl.style.border = '1px solid gray';

    // first row - frets
    const firstRow = tbl.insertRow();
    for (let fret = 0; fret < NUM_FRETS + 1; fret++) {
            const td = firstRow.insertCell();
            var cellText = String(fret).padStart(4," ");
            td.appendChild(document.createTextNode(cellText));
            if (fret == 0) {
                var nut = firstRow.insertCell();
                nut.appendChild(document.createTextNode(" "));
            }
    }
    for (let str = 0; str < psg.strings.length; str++) {
        const tr = tbl.insertRow();
        for (let fret = 0; fret < NUM_FRETS+1; fret++) {
            const td = tr.insertCell();
            note = psg.getNoteAt(str, fret);
            var text = note.getName().padStart(4," ");
            td.appendChild(document.createTextNode(text));
            td.style.border = '1px solid gray';

            note_pos = chord.contains(note);
            bg_color = "#150F14";
            switch(note_pos) {
                case 0:
                    break;
                case 1:
                    bg_color = "green";
                    break;
                case 2:
                    bg_color = "purple";
                    break;
                case 3:
                    bg_color = "maroon";
                    break;
                case 4:
                    bg_color = "darkblue";
                    break;
                default:
                    break;
            }

            td.style.backgroundColor = bg_color;

            // insert the nut
            if (fret == 0) {
                var nut = tr.insertCell();
                nut.appendChild(document.createTextNode(" "));
            }
        }
    }
    divFretboard.innerHTML = "";
    divFretboard.appendChild(tbl);
}

function fretboardUpdate() {
    var root = document.getElementById("rootnote").value;
    var chordType = document.getElementById("chordtype").value;
    var chord = new Chord(root, chordType);

    var pedalA = document.getElementById("A").checked;
    var pedalB = document.getElementById("B").checked;
    var pedalC = document.getElementById("C").checked;
    var leverD = document.getElementById("D").checked;
    var leverE = document.getElementById("E").checked;
    var leverF = document.getElementById("F").checked;
    var leverG = document.getElementById("G").checked;

    pedalA ? document.psg.pedalPush("A") : document.psg.pedalRelease("A");
    pedalB ? document.psg.pedalPush("B") : document.psg.pedalRelease("B");
    pedalC ? document.psg.pedalPush("C") : document.psg.pedalRelease("C");
    leverD ? document.psg.pedalPush("D") : document.psg.pedalRelease("D");
    leverE ? document.psg.pedalPush("E") : document.psg.pedalRelease("E");
    leverF ? document.psg.pedalPush("F") : document.psg.pedalRelease("F");
    leverG ? document.psg.pedalPush("G") : document.psg.pedalRelease("G");

    fretboardCreate(document.psg, 'fretboard', chord);
    fretboardCreate(document.ssg, '6string', chord);
    buildAllOptions('alloptions', chord);
}

document.addEventListener('DOMContentLoaded', function() {
    // Your JavaScript code to run on document load goes here
    document.psg = new PedalSteelGuitar();
    document.ssg = new SixStringGuitar();
    fretboardUpdate();
});

</script>
</head>
<body>
<h1> PSG E9 chord explorer </h1>
<div id="legend">
<table>
<tr>
<td style="background-color: green;">root</td>
<td style="background-color: purple;">third</td>
<td style="background-color: maroon;">fifth</td>
<td style="background-color: darkblue;">seventh</td>
</tr>
</table>
</div>
<div id="fretboard"></div>
<div id="pedals">
Pedals:
<input type="checkbox" id="A" onclick="fretboardUpdate()">A</input>
<input type="checkbox" id="B" onclick="fretboardUpdate()">B</input>
<input type="checkbox" id="C" onclick="fretboardUpdate()">C</input>
</div>
<div id="levers">         
Levers:
<input type="checkbox" id="D" onclick="fretboardUpdate()">D</input>
<input type="checkbox" id="E" onclick="fretboardUpdate()">E</input>
<input type="checkbox" id="F" onclick="fretboardUpdate()">F</input>
<input type="checkbox" id="G" onclick="fretboardUpdate()">G</input>
</div>
<div> 
Root note:
<select id="rootnote" onchange="fretboardUpdate()">
    <option value="C">C</option>
    <option value="C#">C#</option>
    <option value="D">D</option>
    <option value="D#">D#</option>
    <option value="E">E</option>
    <option value="F">F</option>
    <option value="F#">F#</option>
    <option value="G">G</option>
    <option value="G#">G#</option>
    <option value="A">A</option>
    <option value="A#">A#</option>
    <option value="B">B</option>
</select>
</div>
<div> 
Chord type:
<select id="chordtype" onchange="fretboardUpdate()">
    <option value="M">Maj</option>
    <option value="M7">Maj7</option>
    <option value="m">Min</option>
    <option value="m7">Min7</option>
    <option value="aug">Aug</option>
    <option value="dim">Dim</option>
    <option value="dim7">Dim7</option>
    <option value="dom7">Dom7</option>
</select>
</div>
<br/>
<h2>Six string</h2>
<div id="6string">
</div>
<p>
PRs welcome at <a href='https://github.com/trdenton/psghtml'>github/trdenton/psghtml</a>
</p>
<p>
<a href="../index.html">Home</a>
</p>
<div id="alloptions">
</div>
</body>
<html>
