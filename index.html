<html>
<head>
<title>PSG chord explorer</title>
<style>

td {
  white-space: pre;
  font-family: monospace;
  background-color: #150F14;
}

.root {
    background-color: green;
}

.third {
    background-color: purple;
}

.fifth {
    background-color: maroon;
}

.seventh {
    background-color: darkblue;
}

body {
  background-color: #150F14;
  color: #FAF0E6;
}
a:link { 
  color:#D9D4F7;
}
a:visited { 
  color:#8984A7;
}

</style>
<link rel="stylesheet" href="../dm.css">
<script src='psg.js' type='text/javascript'></script>
<script type='text/javascript'>

NUM_FRETS = 24;

function buildAllOptions(elem_id, chord) {
    const div = document.getElementById(elem_id);
    const tbl = document.createElement('table');
    tbl.style.width = '100px';
    tbl.style.border = '1px solid gray';

    const options = findChordPositions(chord);
    const firstRow = tbl.insertRow();
    var td = firstRow.insertCell();
    td.appendChild(document.createTextNode("fret")).border = '1px solid grey';
    td.style.border = '1px solid grey';

    function newRow(fret) {
        const row = tbl.insertRow();
        var td = row.insertCell();
        td.appendChild(document.createTextNode(fret)).border = '1px solid grey';
        td.style.border = '1px solid grey';

        return row;
    }
    var lastFret = -1;
    var row;
    options.forEach((option) => {
        var fret = option[0];
        if (fret != lastFret) {
            row = newRow(fret);    
            lastFret = fret;
        }
        var td = row.insertCell();
        var desc = document.createElement('div');
        desc.textContent = `${option[1]} ${option[2]}`;
        var addbtn = document.createElement('div');
        addbtn.innerHTML="<button>+Tab</button>";
        td.appendChild(addbtn);
        td.appendChild(desc);
        for(var i = 0; i < option[3].length; ++i) {
            var noteType = option[3][i];
            var newDiv = document.createElement('div');
            newDiv.className = noteTypeToClassName(noteType);
            newDiv.textContent = i+1;
            td.appendChild(newDiv);
        }
        var myfunc = function btnFunc() {
            // should be chord, fret, strings, pedals, levers 
            tabEntry = [chord.name, fret, option[3], option[1], option[2]];
            addTabColumn(tabEntry);
        };
        addbtn.addEventListener('click', myfunc);
        td.border = '1px solid grey';
        td.style.border = '1px solid grey';
    });

    div.innerHTML = "";
    div.appendChild(tbl);
}

function noteTypeToClassName(note_pos) {
    switch(note_pos) {
        case 1:
            return "root";
            break;
        case 3:
            return "third";
            break;
        case 5:
            return "fifth";
            break;
        case 7:
            return "seventh";
            break;
        default:
            return "";
            break;
    }
}
function fretboardCreate(psg, elem_id, chord) {
    const divFretboard = document.getElementById(elem_id);
    const body = document.body,
          tbl = document.createElement('table');
    tbl.style.width = '100px';
    tbl.style.border = '1px solid gray';

    // first row - frets
    const firstRow = tbl.insertRow();
    for (let fret = 0; fret < NUM_FRETS + 1; fret++) {
            const td = firstRow.insertCell();
            var cellText = String(fret).padStart(4," ");
            td.appendChild(document.createTextNode(cellText));
            if (fret == 0) {
                var nut = firstRow.insertCell();
                nut.appendChild(document.createTextNode(" "));
            }
    }
    for (let str = 0; str < psg.strings.length; str++) {
        const tr = tbl.insertRow();
        for (let fret = 0; fret < NUM_FRETS+1; fret++) {
            const td = tr.insertCell();
            note = psg.getNoteAt(str, fret);
            var text = note.getName().padStart(4," ");
            td.appendChild(document.createTextNode(text));
            td.style.border = '1px solid gray';

            note_pos = chord.contains(note);
            className = noteTypeToClassName(note_pos);
            td.className = className;

            // insert the nut
            if (fret == 0) {
                var nut = tr.insertCell();
                nut.appendChild(document.createTextNode(" "));
            }
        }
    }
    divFretboard.innerHTML = "";
    divFretboard.appendChild(tbl);
}

function fretboardUpdate() {
    var root = document.getElementById("rootnote").value;
    var chordType = document.getElementById("chordtype").value;
    var chord = new Chord(root, chordType);

    var pedalA = document.getElementById("A").checked;
    var pedalB = document.getElementById("B").checked;
    var pedalC = document.getElementById("C").checked;
    var leverD = document.getElementById("D").checked;
    var leverE = document.getElementById("E").checked;
    var leverF = document.getElementById("F").checked;
    var leverG = document.getElementById("G").checked;

    pedalA ? document.psg.pedalPush("A") : document.psg.pedalRelease("A");
    pedalB ? document.psg.pedalPush("B") : document.psg.pedalRelease("B");
    pedalC ? document.psg.pedalPush("C") : document.psg.pedalRelease("C");
    leverD ? document.psg.pedalPush("D") : document.psg.pedalRelease("D");
    leverE ? document.psg.pedalPush("E") : document.psg.pedalRelease("E");
    leverF ? document.psg.pedalPush("F") : document.psg.pedalRelease("F");
    leverG ? document.psg.pedalPush("G") : document.psg.pedalRelease("G");

    fretboardCreate(document.psg, 'fretboard', chord);
    fretboardCreate(document.ssg, '6string', chord);
    buildAllOptions('alloptions', chord);
}

document.addEventListener('DOMContentLoaded', function() {
    // Your JavaScript code to run on document load goes here
    document.psg = new PedalSteelGuitar();
    document.ssg = new SixStringGuitar();
    fretboardUpdate();
});

function rmTabColumn() {
    const table = document.getElementById("tab_table");

    for(let r = 0; r < 12; ++r) {
        const row = table.rows[r];
        if (row.cells.length > 1)
        {
            const lastTd = row.cells[row.cells.length - 1];
            row.removeChild(lastTd);
        }
    }
}

function addTabColumn(option) {
    // enter a blank spot
    if (typeof(option) === 'string') {
        document.getElementById("top").insertCell().innerHTML = " ";
        for(let s = 1; s < 11; s++) {
            document.getElementById("string"+s).insertCell().innerHTML = option[0];
        }
        document.getElementById("bottom").insertCell().innerHTML = " ";
    } else {
        // should be chord, fret, strings, pedals, levers 
        var chord = option[0];
        var fret = option[1];
        var strings = option[2];
        var pedals = option[3];
        var levers = option[4];
        var pedals_levers = `${pedals} ${levers}`;
        document.getElementById("top").insertCell().innerHTML = chord;
        document.getElementById("bottom").insertCell().innerHTML = pedals_levers;

        var max_str_len = Math.max(chord.length, String(fret).length, pedals_levers.length);

        for(let s = 0; s < 10; s++) {
            var text = "-".repeat(max_str_len+1);
            if (strings[s] != 0) {
                text = String(fret);
                while (text.length < max_str_len+1) {
                    text += "-";
                }
            }
            document.getElementById("string"+(s+1)).insertCell().innerHTML = text;
        }
    }
}

</script>
</head>
<body>
<h1> PSG E9 chord explorer </h1>
<div id="legend">
<table>
<tr>
<td style="background-color: green;">root</td>
<td style="background-color: purple;">third</td>
<td style="background-color: maroon;">fifth</td>
<td style="background-color: darkblue;">seventh</td>
</tr>
</table>
</div>
<div id="fretboard"></div>
<div id="pedals">
Pedals:
<input type="checkbox" id="A" onclick="fretboardUpdate()">A</input>
<input type="checkbox" id="B" onclick="fretboardUpdate()">B</input>
<input type="checkbox" id="C" onclick="fretboardUpdate()">C</input>
</div>
<div id="levers">         
Levers:
<input type="checkbox" id="D" onclick="fretboardUpdate()">D</input>
<input type="checkbox" id="E" onclick="fretboardUpdate()">E</input>
<input type="checkbox" id="F" onclick="fretboardUpdate()">F</input>
<input type="checkbox" id="G" onclick="fretboardUpdate()">G</input>
</div>
<div> 
Root note:
<select id="rootnote" onchange="fretboardUpdate()">
    <option value="C">C</option>
    <option value="C#">C#</option>
    <option value="D">D</option>
    <option value="D#">D#</option>
    <option value="E">E</option>
    <option value="F">F</option>
    <option value="F#">F#</option>
    <option value="G">G</option>
    <option value="G#">G#</option>
    <option value="A">A</option>
    <option value="A#">A#</option>
    <option value="B">B</option>
</select>
</div>
<div> 
Chord type:
<select id="chordtype" onchange="fretboardUpdate()">
    <option value="M">Maj</option>
    <option value="M7">Maj7</option>
    <option value="m">Min</option>
    <option value="m7">Min7</option>
    <option value="aug">Aug</option>
    <option value="dim">Dim</option>
    <option value="dim7">Dim7</option>
    <option value="dom7">Dom7</option>
</select>
</div>
<br/>
<h2>Six string</h2>
<div id="6string">
</div>
<h2>All options</h2>
<div id="alloptions">
</div>

<div id="tab">
<h2>Tab</h3>
<button id="addHypen" onclick="addTabColumn('-')">+space</button>
<button id="addHypen" onclick="rmTabColumn()">bksp</button>
<table id="tab_table">
<tr id="top">
    <td>  </td>
</tr>
<tr id="string1">
    <td>F#|</td>
</tr>
<tr id="string2">
    <td>D#|</td>
</tr>
<tr id="string3">
    <td>G#|</td>
</tr>
<tr id="string4">
    <td>E |</td>
</tr>
<tr id="string5">
    <td>B |</td>
</tr>
<tr id="string6">
    <td>G#|</td>
</tr>
<tr id="string7">
    <td>F#|</td>
</tr>
<tr id="string8">
    <td>E |</td>
</tr>
<tr id="string9">
    <td>D |</td>
</tr>
<tr id="string10">
    <td>B |</td>
</tr>
<tr id="bottom">
<td>  </td>
</tr>
</table>
</div>

<p>
PRs welcome at <a href='https://github.com/trdenton/psghtml'>github/trdenton/psghtml</a>
</p>
<p>
<a href="../index.html">Home</a>
</p>
</body>
<html>
